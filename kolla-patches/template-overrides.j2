{% extends parent_template %}

# Use contrail mirrors - add contrail repo keys
{% block base_header %}
COPY contrail-ubuntu-mirror.key /etc/apt/contrail-ubuntu-mirror.key
RUN apt-key add /etc/apt/contrail-ubuntu-mirror.key && rm -f /etc/apt/contrail-ubuntu-mirror.key
RUN apt-get update
{% endblock %}

# Contrail Neutron plugin packages
{% set neutron_server_packages_append = ['neutron-plugin-contrail', 'python-contrail'] %}

# Contrail Heat plugin packages
{% set heat_engine_packages_append = ['contrail-heat', 'python-contrail'] %}

# Allow Unauthenticated contrail packages
{% block openstack_base_header %}
COPY 99contrail /etc/apt/apt.conf.d/99contrail
{% endblock %}

{% block nova_libvirt_header %}
COPY 99contrail /etc/apt/apt.conf.d/99contrail
{% endblock %}

# Copy vrouter-port-control in Nova compute container
{% block nova_compute_header %}
COPY vrouter-port-control /usr/local/bin/vrouter-port-control
RUN chmod +x /usr/local/bin/vrouter-port-control
{% endblock %}

